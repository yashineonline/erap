import{C as e,D as t,F as n,I as r,L as i,N as a,O as o,P as s,S as c,_ as l,b as u,g as d,k as f,p,u as m,v as h,w as g,x as _,y as v,z as y}from"./vendor-BQYTT8JO.js";import{a as b,d as x,h as S,i as C,m as w,n as T,o as E,s as D,u as O}from"./profiles-CJJEMCwS.js";import{t as k}from"./epub-BkcVe20u.js";var A={class:`card bg-base-200 shadow m-4`},j={class:`card-body`},M={class:`flex items-start justify-between gap-3`},N={class:`badge badge-outline`},P={key:0,class:`mt-2 flex items-center gap-2`},F=[`value`],I={key:1,class:`opacity-70`},L={key:2,class:`alert alert-error`},R={key:3},z={class:`text-lg italic leading-relaxed text-center`},B={key:0,class:`mt-3 text-base font-semibold text-center`},ee={class:`text-right font-semibold mt-3 opacity-90`},V={key:1,class:`mt-2 text-xs opacity-60 text-right`},H={key:4,class:`opacity-70`},U=`dailyQuote:selectedBookId:v1`,W=g({__name:`DailyQuoteCard`,setup(e){let r=n(!0),i=n(``),a=n(null),c=n([]),m=n(``),g=()=>{let e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,`0`)}-${String(e.getDate()).padStart(2,`0`)}`},v=l(()=>new Date().toLocaleDateString(`en-US`,{weekday:`short`,month:`short`,day:`numeric`}));function b(e){return`dailyQuote:v10:${e}`}function x(e){return String(e??``).replace(/\s+/g,` `).trim()}function S(e){return function(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function C(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}function w(e){return e&&typeof e==`object`&&`nodeType`in e&&e.nodeType===9?e:new DOMParser().parseFromString(String(e??``),`text/html`)}function O(e){let t=[],n=0,r=0,i=0,a=0,o=0,s=e=>!!e.closest(`nav,[epub\\:type='toc'],[role='doc-toc'],[role='navigation']`),c=e=>{let t=e.querySelectorAll(`a[href]`);if(!t.length)return e.tagName.toLowerCase()===`a`;let n=x(e.textContent).length,r=0;return t.forEach(e=>{r+=x(e.textContent).length}),n>0&&r>=Math.max(10,.6*n)},l=/^\s*(?:\d{1,4}(?:[.)]\s+|\s+)\S|\d{1,3}\s*:\s*\d{1,3}\b)/,u,d=0,f=Array.from(e.querySelectorAll(`h1,h2,h3,h4,h5,h6,[role='heading'],p,li`));for(let e of f){let f=e.tagName.toLowerCase();if((f===`p`||f===`li`)&&n++,s(e)){r++;continue}let p=x(e.textContent);if(!p)continue;if(/^h[1-6]$/.test(f)||e.getAttribute(`role`)===`heading`){/^Sura\b/i.test(p)&&(u=p,d++);continue}if(c(e)){i++;continue}if(!l.test(p)){a++;continue}o++;let m=x(e.id);t.push({text:p,fragment:m?`#${m}`:void 0,suraLine:u})}if(console.log(`[DailyQuote] extractVerseCandidates:`,{totalNodes:f.length,suraHeadingCount:d,candidates:t.length,firstCandidate:t[0]?.text?.slice(0,120)??null,firstCandidateSura:t[0]?.suraLine??null}),!t.length){let n=String((e.body??e.documentElement)?.textContent??``),r=[],i=/^\s*\d{1,4}(?:[.)]\s+|\s+)\S.*$/gm,a=/^\s*\d{1,3}\s*:\s*\d{1,3}\b.*$/gm;for(let e of n.matchAll(i)){let t=x(e[0]);t&&r.push(t)}for(let e of n.matchAll(a)){let t=x(e[0]);t&&r.push(t)}let o=new Set;for(let e of r)o.has(e)||(o.add(e),t.push({text:e}));console.warn(`[DailyQuote] fallback-to-text regex used:`,{candidates:t.length,sample:t[0]?.text?.slice(0,120)??null})}return console.log(`[DailyQuote] PL stats:`,{totalPL:n,skippedNav:r,skippedLink:i,skippedRegex:a,kept:o}),t}function W(e){let t=[],n=e=>!!e.closest(`nav,[epub\\:type='toc'],[role='doc-toc'],[role='navigation']`),r=e=>{let t=e.querySelectorAll(`a[href]`);if(!t.length)return e.tagName.toLowerCase()===`a`;let n=x(e.textContent).length,r=0;return t.forEach(e=>{r+=x(e.textContent).length}),n>0&&r>=Math.max(10,.6*n)},i=e=>{let t=x(e).replace(/\s+/g,` `).trim();return t?(t.match(/[^.!?]+[.!?]+(?:["”’']?)(?=\s|$)|[^.!?]+$/g)??[]).map(e=>x(e)).filter(e=>e.length>=40):[]},a=e=>{if(n(e)||r(e))return;let a=x(e.textContent);if(!a)return;let o=x(e.id),s=o?`#${o}`:void 0;for(let e of i(a))e.length<50||e.length>260||t.push({text:e,fragment:s})};for(let n of Array.from(e.querySelectorAll(`p,li,blockquote`)))if(a(n),t.length>5e3)break;if(!t.length){let n=String((e.body??e.documentElement)?.textContent??``);for(let e of i(n))e.length<50||e.length>260||t.push({text:e})}return t}function G(e,t){let n=x(e),r=x(t);return n?`Translated by ${n}. ${r}.`:`${r}.`}function K(e,t){let n=x(e),r=x(t);return n?`${n}. ${r}.`:`${r}.`}async function q(e,t){let n=g(),r=b(e.id);if(!t){let t=localStorage.getItem(r);if(t){let r=JSON.parse(t);if(r?.dateISO===n){a.value=r,console.log(`[DailyQuote] loaded from cache`,{bookId:e.id,iso:n});return}}}let i=await E(e.id);if(!i)throw Error(`Book file not found.`);let o=k(await i.arrayBuffer());await o.ready,console.log(`[DailyQuote] book.ready OK`),o.spine.hooks.serialize.register(e=>e.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,``));let s=await o.loaded.metadata,c=x(s?.title)||e.title||`Untitled`,l=x(s?.creator)||e.author||``,u=``;try{let e=o.spine?.items?.[0]?.href;e&&(u=x(w(await o.load(e)).body?.textContent??``).slice(0,6e3))}catch{}let d=T(c,l,u),f=!1;console.log(`[DailyQuote] profiles:`,{metaProfile:e.profile,detectedProfile:d,looksQuranFromHtml:f});let p=(o.spine?.items??[]).filter(e=>typeof e.href==`string`&&e.href.length>0).filter(e=>{let t=String(e.href).toLowerCase().split(`#`)[0].split(`?`)[0],n=t.split(`/`).pop()||t,r=e.properties,i=Array.isArray(r)?r.join(` `):String(r??``);return!(/\bnav\b/i.test(i)||String(e.linear??``).toLowerCase()===`no`||/(^|\/)(nav|toc|contents?|content|title|cover)([-_]\w+)?\.x?html?$/.test(t)||/^(nav|toc|contents?|content|title|cover)([-_]\w+)?\.x?html?$/.test(n))}),m=p.filter(e=>{let t=String(e.href).toLowerCase().split(`#`)[0].split(`?`)[0],n=t.split(`/`).pop()||t;return/^ch\d{3}\.x?html?$/.test(n)}),h=p.filter(e=>{let t=String(e.href).toLowerCase().split(`#`)[0].split(`?`)[0],n=t.split(`/`).pop()||t;return n===`ch004.xhtml`||n===`ch004.html`}),_=x(l).toLowerCase()===`taner`,v=(e.profile===`quran`||d===`quran`)&&_,y=v?h:m.length?m:p;if(!y.length)throw Error(`No readable spine items found.`);if(v&&!h.length)throw Error(`Shaykh Taner - The Quran detected, but appropriate file not found in spine.`);let D=S(C(t?`${e.id}::${n}::${Date.now()}`:`${e.id}::${n}`)),A=``,j=``,M,N=Math.min(25,y.length);for(let t=0;t<N;t++){let n=y[Math.floor(D()*y.length)],r=n?.href?String(n.href):``;if(r){console.log(`[DailyQuote] try spine href:`,{attempt:t+1,href:r});try{let t=w(await o.load(r));if(!f){let e=x(t.querySelector(`h1,h2,h3,h4,h5,h6`)?.textContent);/^Sura\b/i.test(e)&&(f=!0)}let n=e.profile===`quran`||d===`quran`||f,i=n?O(t):W(t);if(!i.length)continue;n&&!f&&i.some(e=>!!x(e.suraLine))&&(f=!0);let a=i[Math.floor(D()*i.length)];if(!a)continue;A=a.text,j=r+(a.fragment??``),M=x(a.suraLine)||void 0,console.log(`[DailyQuote] PICKED:`,{chosenHref:j,textPreview:x(A).slice(0,90),suraFromDoc:M??null});break}catch(e){console.warn(`[DailyQuote] book.load failed for href`,{href:r,err:e instanceof Error?e.message:e});continue}}}if(!A)throw Error(`No verse-like paragraphs found.`);let P=e.profile===`quran`||f||d===`quran`?`quran`:d,F=P===`quran`?M:void 0,I=P===`quran`?G(l,c):K(l,c),L={dateISO:n,bookId:e.id,bookTitle:c,profile:P,text:x(A),citation:I,suraLine:F};localStorage.setItem(r,JSON.stringify(L)),a.value=L,console.log(`[DailyQuote] saved:`,{iso:n,bookId:e.id,chosenHref:j,suraLine:F??null})}async function J(e){r.value=!0,i.value=``,a.value=null;let t=await D();if(c.value=t,!t.length){r.value=!1;return}let n=x(localStorage.getItem(U)),o=m.value||n;(!o||!t.some(e=>e.id===o))&&(o=(t.find(e=>e.profile===`quran`)??t[0]).id),m.value=o,localStorage.setItem(U,o);let s=t.find(e=>e.id===o)??t[0];try{await q(s,e)}catch(e){i.value=e instanceof Error?e.message:`Failed to generate daily quote.`}finally{r.value=!1}}async function Y(){if(!a.value)return;let e=a.value.profile===`quran`,t=x(a.value.suraLine),n=e&&t?`“${a.value.text}”\n${t}\n\n— ${a.value.citation}`:`“${a.value.text}”\n\n— ${a.value.citation}`;await navigator.clipboard.writeText(n)}async function X(){let e=x(m.value);e&&(localStorage.setItem(U,e),await J(!1))}async function Z(){await J(!0)}return t(()=>{J(!1)}),(e,t)=>(o(),_(`div`,A,[h(`div`,j,[h(`div`,M,[t[1]||=h(`div`,{class:`text-lg font-semibold`},`Daily Quote`,-1),h(`div`,N,y(v.value),1)]),c.value.length>1?(o(),_(`div`,P,[t[2]||=h(`span`,{class:`text-sm opacity-70`},`Book:`,-1),s(h(`select`,{class:`select select-bordered select-sm w-full max-w-xs`,"onUpdate:modelValue":t[0]||=e=>m.value=e,onChange:X},[(o(!0),_(d,null,f(c.value,e=>(o(),_(`option`,{key:e.id,value:e.id},y((e.title||`Untitled`)+(e.author?` — `+e.author:``)),9,F))),128))],544),[[p,m.value]])])):u(``,!0),r.value?(o(),_(`div`,I,`Loading daily quote…`)):i.value?(o(),_(`div`,L,[h(`span`,null,y(i.value),1)])):a.value?(o(),_(`div`,R,[h(`blockquote`,z,` “`+y(a.value.text)+`” `,1),a.value.profile===`quran`&&a.value.suraLine?(o(),_(`p`,B,y(a.value.suraLine),1)):u(``,!0),h(`p`,ee,` — `+y(a.value.citation),1),h(`div`,{class:`mt-4 flex flex-wrap gap-2 justify-end`},[h(`button`,{class:`btn btn-sm btn-outline`,onClick:Y},`Copy`),h(`button`,{class:`btn btn-sm`,onClick:Z,title:`Generate a new quote (and cache it for today)`},` New for today `)]),a.value.bookTitle?(o(),_(`div`,V,` Source: `+y(a.value.bookTitle),1)):u(``,!0)])):(o(),_(`div`,H,` Import a Quran EPUB (or any EPUB) to enable daily quotes. `))])]))}}),G={class:`fixed inset-0 bg-base-100 flex items-center justify-center p-6`},K={class:`max-w-md w-full`},q={class:`card bg-base-200 shadow-xl`},J={class:`card-body`},Y={class:`text-xl font-semibold`},X={class:`opacity-80 mt-2`},Z={class:`mt-6 flex items-center justify-between`},Q={class:`mt-4 flex gap-2 justify-center`},te=g({__name:`Onboarding`,emits:[`done`],setup(e,{emit:t}){let r=t,a=[{title:`Import any EPUB`,text:`Add books from your device. Everything stays local.`},{title:`Tap for pop-ups`,text:`Footnotes/glossary open as a popup. Fallback dictionary is available too.`},{title:`Search + Study Mode`,text:`Full-text search, themes, fonts, and a distraction-free study mode.`},{title:`Read aloud + Analytics`,text:`Text-to-speech and reading stats per book.`}],s=n(0),c=l(()=>s.value===a.length-1);function u(){c.value?r(`done`):s.value+=1}return(e,t)=>(o(),_(`div`,G,[h(`div`,K,[h(`div`,q,[h(`div`,J,[h(`div`,Y,y(a[s.value]?.title),1),h(`div`,X,y(a[s.value]?.text),1),h(`div`,Z,[h(`button`,{class:`btn btn-ghost`,onClick:t[0]||=e=>r(`done`)},`Skip`),h(`button`,{class:`btn btn-primary`,onClick:t[1]||=e=>u()},y(c.value?`Start reading`:`Next`),1)]),h(`div`,Q,[(o(),_(d,null,f(a,(e,t)=>h(`div`,{key:e.title,class:i([`w-2 h-2 rounded-full`,t===s.value?`bg-primary`:`bg-base-300`])},null,2)),64))])])]),t[2]||=h(`div`,{class:`text-xs opacity-60 mt-3 text-center`},` Tip: “Install” from your browser menu for an app-like experience. `,-1)])]))}}),ne={class:`min-h-full bg-base-100`},re={class:`navbar bg-base-200 shadow-sm`},ie={class:`flex-none`},ae={class:`btn btn-primary btn-sm`},oe={class:`p-4 max-w-4xl mx-auto`},se={key:0,class:`opacity-70`},ce={class:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`},le={class:`card-body`},ue={class:`font-semibold truncate`},de={class:`text-xs opacity-60`},fe={class:`card-actions justify-end mt-3`},$=[`onClick`],pe=[`onClick`],me={class:`text-sm space-y-2`},he={class:`space-y-4`},ge={class:`text-sm leading-relaxed`},_e={class:`flex items-center justify-between`},ve=[`disabled`],ye={class:`text-xs opacity-70`},be=g({__name:`Home`,setup(i){let s=n(!1),p=l(()=>new Date(`2026-01-20T10:53:21.909Z`).toLocaleDateString(`en-US`,{year:`numeric`,month:`long`,day:`numeric`})),g=m(),T=n([]),E=n(!1),k=n(!1),A=n(0),j=[{title:`Import an EPUB`,body:`Tap “Import EPUB” to add a book from your device.`},{title:`Open a book`,body:`Tap a book cover/title to enter the reader.`},{title:`Glossary popups`,body:`Tap underlined glossary/footnote links to see the definition popup.`},{title:`Search`,body:`Use search to find text and jump directly to the match.`},{title:`Study mode`,body:`Enable Study Mode, then tap once on the page to show/hide controls.`}],M=l(()=>j[A.value]??j[0]);function N(){A.value=0,k.value=!0}function P(){A.value<j.length-1&&A.value++}function F(){A.value>0&&A.value--}function I(){k.value=!1}t(async()=>{T.value=await D(),E.value=!await b()});async function L(e){let t=e.target,n=t.files?.[0];if(!n)return;let r=crypto.randomUUID?.()??`${Date.now()}-${Math.random()}`,i={id:r,title:n.name.replace(/\.epub$/i,``),addedAt:Date.now()};await O(r,n),T.value=[i,...T.value],await x(T.value),t.value=``,g.push(`/read/${encodeURIComponent(r)}`)}async function R(e){g.push(`/read/${encodeURIComponent(e)}`)}async function z(e){await C(e),T.value=await D()}async function B(){await w(),E.value=!1}return(t,n)=>(o(),_(`div`,ne,[h(`div`,re,[n[6]||=h(`div`,{class:`flex-1 px-2 text-lg font-semibold`},`Ebook Reader Ansari Publications`,-1),h(`div`,{class:`alert alert-info rounded-none flex items-center justify-between`},[n[3]||=h(`div`,{class:`flex items-center gap-2`},[h(`span`,{class:`font-semibold`},`Onboarding Tour`),h(`span`,{class:`text-sm opacity-80 hidden sm:inline`},`Quick guide to get started.`)],-1),h(`button`,{class:`btn btn-sm`,onClick:N},`Start`)]),h(`div`,ie,[h(`label`,ae,[n[4]||=c(` Import EPUB `,-1),h(`input`,{type:`file`,accept:`.epub`,class:`hidden`,onChange:L},null,32)]),h(`button`,{class:`btn btn-ghost btn-sm`,onClick:n[0]||=e=>s.value=!0,"aria-label":`About`},[...n[5]||=[h(`svg`,{xmlns:`http://www.w3.org/2000/svg`,class:`h-5 w-5`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,"stroke-width":`2`},[h(`circle`,{cx:`12`,cy:`12`,r:`9`}),h(`path`,{d:`M12 10v7`}),h(`path`,{d:`M12 7h.01`})],-1)]])])]),e(W),h(`div`,oe,[T.value.length===0?(o(),_(`div`,se,` Import an EPUB to start. `)):u(``,!0),h(`div`,ce,[(o(!0),_(d,null,f(T.value,e=>(o(),_(`div`,{key:e.id,class:`card bg-base-200 shadow`},[h(`div`,le,[h(`div`,ue,y(e.title),1),h(`div`,de,y(new Date(e.addedAt).toLocaleString()),1),h(`div`,fe,[h(`button`,{class:`btn btn-ghost btn-sm`,onClick:t=>z(e.id)},`Remove`,8,$),h(`button`,{class:`btn btn-primary btn-sm`,onClick:t=>R(e.id)},`Open`,8,pe)])])]))),128))])]),E.value?(o(),v(te,{key:0,onDone:B})):u(``,!0),e(S,{open:s.value,title:`About ERAP`,onClose:n[1]||=e=>s.value=!1},{default:a(()=>[h(`div`,me,[h(`div`,null,[n[7]||=h(`span`,{class:`font-semibold`},`Version:`,-1),c(` `+y(r(`0.06`)),1)]),h(`div`,null,[n[8]||=h(`span`,{class:`font-semibold`},`Built:`,-1),c(` `+y(p.value),1)])])]),_:1},8,[`open`]),e(S,{open:k.value,title:M.value.title,onClose:I},{default:a(()=>[h(`div`,he,[h(`p`,ge,y(M.value.body),1),h(`div`,_e,[h(`button`,{class:`btn btn-sm`,disabled:A.value===0,onClick:F},`Back`,8,ve),h(`div`,ye,y(A.value+1)+` / `+y(j.length),1),h(`button`,{class:`btn btn-sm btn-primary`,onClick:n[2]||=e=>A.value===j.length-1?I():P()},y(A.value===j.length-1?`Done`:`Next`),1)])])]),_:1},8,[`open`,`title`])]))}});export{be as default};